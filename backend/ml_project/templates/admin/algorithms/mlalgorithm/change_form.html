{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
.form-section {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}
.form-section h2 {
    color: #1f2937;
    border-bottom: 2px solid #3b82f6;
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.form-row {
    margin-bottom: 15px;
}
.form-row label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    color: #374151;
}
.form-row input, .form-row select, .form-row textarea {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    font-size: 14px;
}
.form-row textarea {
    min-height: 80px;
    resize: vertical;
}
.help-text {
    font-size: 12px;
    color: #6b7280;
    margin-top: 4px;
}
.submit-row {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    display: flex;
    gap: 10px;
}
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
}
.btn-primary {
    background: #3b82f6;
    color: white;
}
.btn-secondary {
    background: #6b7280;
    color: white;
}
.preview-section {
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
}
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <form method="post" id="algorithm-form">
        {% csrf_token %}
        
        <div class="form-section">
            <h2>Basic Information</h2>
            
            <div class="form-row">
                <label for="id_name">Algorithm Name:</label>
                {{ form.name }}
                <div class="help-text">Enter the full name of the algorithm (e.g., "Random Forest")</div>
            </div>
            
            <div class="form-row">
                <label for="id_algorithm_type">Algorithm Type:</label>
                {{ form.algorithm_type }}
            </div>
            
            <div class="form-row">
                <label for="id_short_description">Short Description:</label>
                {{ form.short_description }}
                <div class="help-text">Brief description of what this algorithm does (2-3 sentences)</div>
            </div>
            
            <div class="form-row">
                <label for="id_wikipedia_url">Wikipedia URL:</label>
                {{ form.wikipedia_url }}
                <div class="help-text">Link to the Wikipedia page for this algorithm</div>
            </div>
        </div>

        <div class="form-section">
            <h2>Technical Details</h2>
            
            <div class="form-row">
                <label for="id_implementation_code">Implementation Code:</label>
                {{ form.implementation_code }}
                <div class="help-text">Python code showing how to implement this algorithm</div>
            </div>
            
            <div class="form-row">
                <label for="id_accuracy">Accuracy Score:</label>
                {{ form.accuracy }}
                <div class="help-text">Enter as decimal (e.g., 0.85 for 85%)</div>
            </div>
        </div>

        <div class="form-section">
            <h2>Use Cases & Analysis</h2>
            
            <div class="form-row">
                <label for="id_use_cases">Use Cases:</label>
                {{ form.use_cases }}
                <div class="help-text">Common applications and scenarios for this algorithm</div>
            </div>
            
            <div class="form-row">
                <label for="id_pros">Advantages (Pros):</label>
                {{ form.pros }}
                <div class="help-text">Strengths and benefits of this algorithm</div>
            </div>
            
            <div class="form-row">
                <label for="id_cons">Limitations (Cons):</label>
                {{ form.cons }}
                <div class="help-text">Weaknesses and limitations of this algorithm</div>
            </div>
        </div>

        <div class="submit-row">
            <input type="submit" value="Save Algorithm" class="btn btn-primary" name="_save">
            <input type="submit" value="Save and add another" class="btn btn-secondary" name="_addanother">
            <input type="submit" value="Save and continue editing" class="btn btn-secondary" name="_continue">
            <a href="../" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
// Auto-fill Wikipedia URL when algorithm name is entered
document.getElementById('id_name').addEventListener('blur', function() {
    const nameField = this;
    const wikipediaField = document.getElementById('id_wikipedia_url');
    
    if (nameField.value && !wikipediaField.value) {
        const algorithmName = nameField.value.toLowerCase().replace(/\s+/g, '_');
        wikipediaField.value = `https://en.wikipedia.org/wiki/${algorithmName}`;
    }
});

// Auto-generate basic implementation code based on algorithm type
document.getElementById('id_algorithm_type').addEventListener('change', function() {
    const type = this.value;
    const codeField = document.getElementById('id_implementation_code');
    
    if (!codeField.value) {
        let baseCode = '';
        switch(type) {
            case 'classification':
                baseCode = `from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score

# Load your data
# X, y = load_data()

# Split data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Create and train model
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# Make predictions
predictions = model.predict(X_test)

# Calculate accuracy
accuracy = accuracy_score(y_test, predictions)
print(f"Model Accuracy: {accuracy:.2%}")`;
                break;
            case 'regression':
                baseCode = `from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score

# Load your data
# X, y = load_data()

# Split data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Create and train model
model = LinearRegression()
model.fit(X_train, y_train)

# Make predictions
predictions = model.predict(X_test)

# Calculate metrics
mse = mean_squared_error(y_test, predictions)
r2 = r2_score(y_test, predictions)
print(f"Mean Squared Error: {mse:.2f}")
print(f"RÂ² Score: {r2:.2f}")`;
                break;
            case 'clustering':
                baseCode = `from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler

# Load your data
# X = load_data()

# Scale the data
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# Create and fit model
model = KMeans(n_clusters=3, random_state=42)
clusters = model.fit_predict(X_scaled)

# View cluster centers
print("Cluster centers:")
print(model.cluster_centers_)`;
                break;
        }
        
        if (baseCode) {
            codeField.value = baseCode;
        }
    }
});
</script>
{% endblock %}
